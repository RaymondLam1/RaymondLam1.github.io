import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,b as i,f as s,a as t,e as o,o as r}from"./app-30hlg77a.js";const l={};function d(c,e){return r(),n("div",null,[e[0]||(e[0]=i("p",null,[s("介绍快速打开、搜索文件的 "),i("code",null,":find"),s(","),i("code",null,":vim"),s(","),i("code",null,":grep"),s("，使用 vim 支持现代编辑器中多文件文本替换功能。")],-1)),t(" more "),e[1]||(e[1]=o(`<h1 id="ch03-searching-files" tabindex="-1"><a class="header-anchor" href="#ch03-searching-files"><span>Ch03. Searching Files</span></a></h1><p>The goal of this chapter is to give you an introduction on how to search quickly in Vim. Being able to search quickly is a great way to jump-start your Vim productivity. When I figured out how to search files quickly, I made the switch to use Vim full-time.</p><p>This chapter is divided into two parts: how to search without plugins and how to search with <a href="https://github.com/junegunn/fzf.vim" target="_blank" rel="noopener noreferrer">fzf.vim</a> plugin. Let&#39;s get started!</p><h2 id="opening-and-editing-files" tabindex="-1"><a class="header-anchor" href="#opening-and-editing-files"><span>Opening and Editing Files</span></a></h2><p>To open a file in Vim, you can use <code>:edit</code>.</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:edit file.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If <code>file.txt</code> exists, it opens the <code>file.txt</code> buffer. If <code>file.txt</code> doesn&#39;t exist, it creates a new buffer for <code>file.txt</code>.</p><p>Autocomplete with <code>&lt;Tab&gt;</code> works with <code>:edit</code>. For example, if your file is inside a <a href="https://rubyonrails.org/" target="_blank" rel="noopener noreferrer">Rails</a> <em>a</em>pp <em>c</em>ontroller <em>u</em>sers controller directory <code>./app/controllers/users_controllers.rb</code>, you can use <code>&lt;Tab&gt;</code> to expand the terms quickly:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:edit a&lt;Tab&gt;c&lt;Tab&gt;u&lt;Tab&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>:edit</code> accepts wildcards arguments. <code>*</code> matches any file in the current directory. If you are only looking for files with <code>.yml</code> extension in the current directory:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:edit *.yml&lt;Tab&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Vim will give you a list of all <code>.yml</code> files in the current directory to choose from.</p><p>You can use <code>**</code> to search recursively. If you want to look for all <code>*.md</code> files in your project, but you are not sure in which directories, you can do this:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:edit **/*.md&lt;Tab&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>:edit</code> can be used to run <code>netrw</code>, Vim&#39;s built-in file explorer. To do that, give <code>:edit</code> a directory argument instead of file:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:edit .</span></span>
<span class="line"><span>:edit test/unit/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="searching-files-with-find" tabindex="-1"><a class="header-anchor" href="#searching-files-with-find"><span>Searching Files With Find</span></a></h2><p>You can find files with <code>:find</code>. For example:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:find package.json</span></span>
<span class="line"><span>:find app/controllers/users_controller.rb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Autocomplete also works with <code>:find</code>:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:find p&lt;Tab&gt;                &quot; to find package.json</span></span>
<span class="line"><span>:find a&lt;Tab&gt;c&lt;Tab&gt;u&lt;Tab&gt;    &quot; to find app/controllers/users_controller.rb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>You may notice that <code>:find</code> looks like <code>:edit</code>. What&#39;s the difference?</p><h2 id="find-and-path" tabindex="-1"><a class="header-anchor" href="#find-and-path"><span>Find and Path</span></a></h2><p>The difference is that <code>:find</code> finds file in <code>path</code>, <code>:edit</code> doesn&#39;t. Let&#39;s learn a little bit about <code>path</code>. Once you learn how to modify your paths, <code>:find</code> can become a powerful searching tool. To check what your paths are, do:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:set path?</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>By default, yours probably look like this:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>path=.,/usr/include,,</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>.</code> means to search in the directory of the currently opened file.</li><li><code>,</code> means to search in the current directory.</li><li><code>/usr/include</code> is the typical directory for C libraries header files.</li></ul><p>The first two are important in our context and the third one can be ignored for now. The takeaway here is that you can modify your own paths, where Vim will look for files. Let&#39;s assume this is your project structure:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>app/</span></span>
<span class="line"><span>  assets/</span></span>
<span class="line"><span>  controllers/</span></span>
<span class="line"><span>    application_controller.rb</span></span>
<span class="line"><span>    comments_controller.rb</span></span>
<span class="line"><span>    users_controller.rb</span></span>
<span class="line"><span>    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you want to go to <code>users_controller.rb</code> from the root directory, you have to go through several directories (and pressing a considerable amount of tabs). Often when working with a framework, you spend 90% of your time in a particular directory. In this situation, you only care about going to the <code>controllers/</code> directory with the least amount of keystrokes. The <code>path</code> setting can shorten that journey.</p><p>You need to add the <code>app/controllers/</code> to the current <code>path</code>. Here is how you can do it:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:set path+=app/controllers/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Now that your path is updated, when you type <code>:find u&lt;Tab&gt;</code>, Vim will now search inside <code>app/controllers/</code> directory for files starting with &quot;u&quot;.</p><p>If you have a nested <code>controllers/</code> directory, like <code>app/controllers/account/users_controller.rb</code>, Vim won&#39;t find <code>users_controllers</code>. Instead, you need to add <code>:set path+=app/controllers/**</code> in order for autocompletion will find <code>users_controller.rb</code>. This is great! Now you can find the users controller with 1 press of tab instead of 3.</p><p>You might be thinking to add the entire project directories so when you press <code>tab</code>, Vim will search everywhere for that file, like this:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:set path+=$PWD/**</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>$PWD</code> is the current working directory. If you try to add your entire project to <code>path</code> hoping to make all files reachable upon a <code>tab</code> press, although this may work for a small project, doing this will slow down your search significantly if you have a large number of files in your project. I recommend adding only the <code>path</code> of your most visited files / directories.</p><p>You can add the <code>set path+={your-path-here}</code> in your vimrc. Updating <code>path</code> takes only a few seconds and doing so can save you a lot of time.</p><h2 id="searching-in-files-with-grep" tabindex="-1"><a class="header-anchor" href="#searching-in-files-with-grep"><span>Searching in Files With Grep</span></a></h2><p>If you need to find in files (find phrases in files), you can use grep. Vim has two ways of doing that:</p><ul><li>Internal grep (<code>:vim</code>. Yes, it is spelled <code>:vim</code>. It is short for <code>:vimgrep</code>).</li><li>External grep (<code>:grep</code>).</li></ul><p>Let&#39;s go through internal grep first. <code>:vim</code> has the following syntax:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:vim /pattern/ file</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>/pattern/</code> is a regex pattern of your search term.</li><li><code>file</code> is the file argument. You can pass multiple arguments. Vim will search for the pattern inside the file argument. Similar to <code>:find</code>, you can pass it <code>*</code> and <code>**</code> wildcards.</li></ul><p>For example, to look for all occurrences of &quot;breakfast&quot; string inside all ruby files (<code>.rb</code>) inside <code>app/controllers/</code> directory:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:vim /breakfast/ app/controllers/**/*.rb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>After running that, you will be redirected to the first result. Vim&#39;s <code>vim</code> search command uses <code>quickfix</code> operation. To see all search results, run <code>:copen</code>. This opens a <code>quickfix</code> window. Here are some useful quickfix commands to get you productive immediately:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:copen        Open the quickfix window</span></span>
<span class="line"><span>:cclose       Close the quickfix window</span></span>
<span class="line"><span>:cnext        Go to the next error</span></span>
<span class="line"><span>:cprevious    Go to the previous error</span></span>
<span class="line"><span>:colder       Go to the older error list</span></span>
<span class="line"><span>:cnewer       Go to the newer error list</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>To learn more about quickfix, check out <code>:h quickfix</code>.</p><p>You may notice that running internal grep (<code>:vim</code>) can get slow if you have a large number of matches. This is because Vim loads each matching file into memory, as if it were being edited. If Vim finds a large number of files matching your search, it will load them all and therefore consume a large amount of memory.</p><p>Let&#39;s talk about external grep. By default, it uses <code>grep</code> terminal command. To search for &quot;lunch&quot; inside a ruby file inside <code>app/controllers/</code> directory, you can do this:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:grep -R &quot;lunch&quot; app/controllers/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Note that instead of using <code>/pattern/</code>, it follows the terminal grep syntax <code>&quot;pattern&quot;</code>. It also displays all matches using <code>quickfix</code>.</p><p>Vim defines the <code>grepprg</code> variable to determine which external program to run when running the <code>:grep</code> Vim command so that you don&#39;t have to close Vim and invoke the terminal <code>grep</code> command. Later, I will show you how to change the default program invoked when using the <code>:grep</code> Vim command.</p><h2 id="browsing-files-with-netrw" tabindex="-1"><a class="header-anchor" href="#browsing-files-with-netrw"><span>Browsing Files With Netrw</span></a></h2><p><code>netrw</code> is Vim&#39;s built-in file explorer. It is useful to see a project&#39;s hierarchy. To run <code>netrw</code>, you need these two settings in your <code>.vimrc</code>:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>set nocp</span></span>
<span class="line"><span>filetype plugin on</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Since <code>netrw</code> is a vast topic, I will only cover the basic usage, but it should be enough to get you started. You can start <code>netrw</code> when you launch Vim by passing it a directory as a parameter instead of a file. For example:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>vim .</span></span>
<span class="line"><span>vim src/client/</span></span>
<span class="line"><span>vim app/controllers/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>To launch <code>netrw</code> from inside Vim, you can use the <code>:edit</code> command and pass it a directory parameter instead of a filename:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:edit .</span></span>
<span class="line"><span>:edit src/client/</span></span>
<span class="line"><span>:edit app/controllers/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>There are other ways to launch <code>netrw</code> window without passing a directory:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:Explore     Starts netrw on current file</span></span>
<span class="line"><span>:Sexplore    No kidding. Starts netrw on split top half of the screen</span></span>
<span class="line"><span>:Vexplore    Starts netrw on split left half of the screen</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can navigate <code>netrw</code> with Vim motions (motions will be covered in depth in a later chapter). If you need to create, delete, or rename a file or directory, here is a list of useful <code>netrw</code> commands:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>%    Create a new file</span></span>
<span class="line"><span>d    Create a new directory</span></span>
<span class="line"><span>R    Rename a file or directory</span></span>
<span class="line"><span>D    Delete a file or directory</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>:h netrw</code> is very comprehensive. Check it out if you have time.</p><p>If you find <code>netrw</code> too bland and need more flavor, <a href="https://github.com/tpope/vim-vinegar" target="_blank" rel="noopener noreferrer">vim-vinegar</a> is a good plugin to improve <code>netrw</code>. If you&#39;re looking for a different file explorer, <a href="https://github.com/preservim/nerdtree" target="_blank" rel="noopener noreferrer">NERDTree</a> is a good alternative. Check them out!</p><h2 id="fzf" tabindex="-1"><a class="header-anchor" href="#fzf"><span>Fzf</span></a></h2><p>Now that you&#39;ve learned how to search files in Vim with built-in tools, let&#39;s learn how to do it with plugins.</p><p>One thing that modern text editors get right and that Vim didn&#39;t is how easy it is to find files, especially via fuzzy search. In this second half of the chapter, I will show you how to use <a href="https://github.com/junegunn/fzf.vim" target="_blank" rel="noopener noreferrer">fzf.vim</a> to make searching in Vim easy and powerful.</p><h2 id="setup" tabindex="-1"><a class="header-anchor" href="#setup"><span>Setup</span></a></h2><p>First, make sure you have <a href="https://github.com/junegunn/fzf" target="_blank" rel="noopener noreferrer">fzf</a> and <a href="https://github.com/BurntSushi/ripgrep" target="_blank" rel="noopener noreferrer">ripgrep</a> downloaded. Follow the instruction on their github repo. The commands <code>fzf</code> and <code>rg</code> should now be available after successful installs.</p><p>Ripgrep is a search tool much like grep (hence the name). It is generally faster than grep and has many useful features. Fzf is a general-purpose command-line fuzzy finder. You can use it with any commands, including ripgrep. Together, they make a powerful search tool combination.</p><p>Fzf does not use ripgrep by default, so we need to tell fzf to use ripgrep by defining a <code>FZF_DEFAULT_COMMAND</code> variable. In my <code>.zshrc</code> (<code>.bashrc</code> if you use bash), I have these:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>if type rg &amp;&gt; /dev/null; then</span></span>
<span class="line"><span>  export FZF_DEFAULT_COMMAND=&#39;rg --files&#39;</span></span>
<span class="line"><span>  export FZF_DEFAULT_OPTS=&#39;-m&#39;</span></span>
<span class="line"><span>fi</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Pay attention to <code>-m</code> in <code>FZF_DEFAULT_OPTS</code>. This option allows us to make multiple selections with <code>&lt;Tab&gt;</code> or <code>&lt;Shift-Tab&gt;</code>. You don&#39;t need this line to make fzf work with Vim, but I think it is a useful option to have. It will come in handy when you want to perform search and replace in multiple files which I&#39;ll cover in just a little. The fzf command accepts many more options, but I won&#39;t cover them here. To learn more, check out <a href="https://github.com/junegunn/fzf#usage" target="_blank" rel="noopener noreferrer">fzf&#39;s repo</a> or <code>man fzf</code>. At minimum you should have <code>export FZF_DEFAULT_COMMAND=&#39;rg&#39;</code>.</p><p>After installing fzf and ripgrep, let&#39;s set up the fzf plugin. I am using <a href="https://github.com/junegunn/vim-plug" target="_blank" rel="noopener noreferrer">vim-plug</a> plugin manager in this example, but you can use any plugin managers.</p><p>Add these inside your <code>.vimrc</code> plugins. You need to use <a href="https://github.com/junegunn/fzf.vim" target="_blank" rel="noopener noreferrer">fzf.vim</a> plugin (created by the same fzf author).</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>call plug#begin()</span></span>
<span class="line"><span>Plug &#39;junegunn/fzf.vim&#39;</span></span>
<span class="line"><span>Plug &#39;junegunn/fzf&#39;, { &#39;do&#39;: { -&gt; fzf#install() } }</span></span>
<span class="line"><span>call plug#end()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After adding these lines, you will need to open <code>vim</code> and run <code>:PlugInstall</code>. It will install all plugins that are defined in your <code>vimrc</code> file and are not installed. In our case, it will install <code>fzf.vim</code> and <code>fzf</code>.</p><p>For more info about this plugin, you can check out <a href="https://github.com/junegunn/fzf/blob/master/README-VIM.md" target="_blank" rel="noopener noreferrer">fzf.vim repo</a>.</p><h2 id="fzf-syntax" tabindex="-1"><a class="header-anchor" href="#fzf-syntax"><span>Fzf Syntax</span></a></h2><p>To use fzf efficiently, you should learn some basic fzf syntax. Fortunately, the list is short:</p><ul><li><code>^</code> is a prefix exact match. To search for a phrase starting with &quot;welcome&quot;: <code>^welcome</code>.</li><li><code>$</code> is a suffix exact match. To search for a phrase ending with &quot;my friends&quot;: <code>friends$</code>.</li><li><code>&#39;</code> is an exact match. To search for the phrase &quot;welcome my friends&quot;: <code>&#39;welcome my friends</code>.</li><li><code>|</code> is an &quot;or&quot; match. To search for either &quot;friends&quot; or &quot;foes&quot;: <code>friends | foes</code>.</li><li><code>!</code> is an inverse match. To search for phrase containing &quot;welcome&quot; and not &quot;friends&quot;: <code>welcome !friends</code></li></ul><p>You can mix and match these options. For example, <code>^hello | ^welcome friends$</code> will search for the phrase starting with either &quot;welcome&quot; or &quot;hello&quot; and ending with &quot;friends&quot;.</p><h2 id="finding-files" tabindex="-1"><a class="header-anchor" href="#finding-files"><span>Finding Files</span></a></h2><p>To search for files inside Vim using fzf.vim plugin, you can use the <code>:Files</code> method. Run <code>:Files</code> from Vim and you will be prompted with fzf search prompt.</p><p>Since you will be using this command frequently, it is good to have this mapped to a keyboard shortcut. I map mine to <code>Ctrl-f</code>. In my vimrc, I have this:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>nnoremap &lt;silent&gt; &lt;C-f&gt; :Files&lt;CR&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="finding-in-files" tabindex="-1"><a class="header-anchor" href="#finding-in-files"><span>Finding in Files</span></a></h2><p>To search inside files, you can use the <code>:Rg</code> command.</p><p>Again, since you will probably use this frequently, let&#39;s map it to a keyboard shortcut. I map mine to <code>&lt;Leader&gt;f</code>. The <code>&lt;Leader&gt;</code> key is mapped to <code>\\</code> by default.</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>nnoremap &lt;silent&gt; &lt;Leader&gt;f :Rg&lt;CR&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="other-searches" tabindex="-1"><a class="header-anchor" href="#other-searches"><span>Other Searches</span></a></h2><p>Fzf.vim provides many other search commands. I won&#39;t go through each one of them here, but you can check them out <a href="https://github.com/junegunn/fzf.vim#commands" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Here&#39;s what my fzf maps look like:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>nnoremap &lt;silent&gt; &lt;Leader&gt;b :Buffers&lt;CR&gt;</span></span>
<span class="line"><span>nnoremap &lt;silent&gt; &lt;C-f&gt; :Files&lt;CR&gt;</span></span>
<span class="line"><span>nnoremap &lt;silent&gt; &lt;Leader&gt;f :Rg&lt;CR&gt;</span></span>
<span class="line"><span>nnoremap &lt;silent&gt; &lt;Leader&gt;/ :BLines&lt;CR&gt;</span></span>
<span class="line"><span>nnoremap &lt;silent&gt; &lt;Leader&gt;&#39; :Marks&lt;CR&gt;</span></span>
<span class="line"><span>nnoremap &lt;silent&gt; &lt;Leader&gt;g :Commits&lt;CR&gt;</span></span>
<span class="line"><span>nnoremap &lt;silent&gt; &lt;Leader&gt;H :Helptags&lt;CR&gt;</span></span>
<span class="line"><span>nnoremap &lt;silent&gt; &lt;Leader&gt;hh :History&lt;CR&gt;</span></span>
<span class="line"><span>nnoremap &lt;silent&gt; &lt;Leader&gt;h: :History:&lt;CR&gt;</span></span>
<span class="line"><span>nnoremap &lt;silent&gt; &lt;Leader&gt;h/ :History/&lt;CR&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="replacing-grep-with-rg" tabindex="-1"><a class="header-anchor" href="#replacing-grep-with-rg"><span>Replacing Grep With Rg</span></a></h2><p>As mentioned earlier, Vim has two ways to search in files: <code>:vim</code> and <code>:grep</code>. <code>:grep</code> uses external search tool that you can reassign using the <code>grepprg</code> keyword. I will show you how to configure Vim to use ripgrep instead of terminal grep when running the <code>:grep</code> command.</p><p>Now let&#39;s setup <code>grepprg</code> so that the <code>:grep</code> Vim command uses ripgrep. Add this in your vimrc:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>set grepprg=rg\\ --vimgrep\\ --smart-case\\ --follow</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Feel free to modify some of the options above! For more information on what the options above mean, check out <code>man rg</code>.</p><p>After you updated <code>grepprg</code>, now when you run <code>:grep</code>, it runs <code>rg --vimgrep --smart-case --follow</code> instead of <code>grep</code>. If you want to search for &quot;donut&quot; using ripgrep, you can now run a more succinct command <code>:grep &quot;donut&quot;</code> instead of <code>:grep &quot;donut&quot; . -R</code></p><p>Just like the old <code>:grep</code>, this new <code>:grep</code> also uses quickfix to display results.</p><p>You might wonder, &quot;Well, this is nice but I never used <code>:grep</code> in Vim, plus can&#39;t I just use <code>:Rg</code> to find phrases in files? When will I ever need to use <code>:grep</code>?</p><p>That is a very good question. You may need to use <code>:grep</code> in Vim to do search and replace in multiple files, which I will cover next.</p><h2 id="search-and-replace-in-multiple-files" tabindex="-1"><a class="header-anchor" href="#search-and-replace-in-multiple-files"><span>Search and Replace in Multiple Files</span></a></h2><p>Modern text editors like VSCode makes it very easy to search and replace a string across multiple files. In this section, I will show you two different methods to easily do that in Vim.</p><p>The first method is to replace <em>all</em> matching phrases in your project. You will need to use <code>:grep</code>. If you want to replace all instances of &quot;pizza&quot; with &quot;donut&quot;, here&#39;s what you do:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>:grep &quot;pizza&quot;</span></span>
<span class="line"><span>:cfdo %s/pizza/donut/g | update</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Let&#39;s break down the commands:</p><ol><li><code>:grep pizza</code> uses ripgrep to search for all instances of &quot;pizza&quot; (by the way, this would still work even if you didn&#39;t reassign <code>grepprg</code> to use ripgrep. You would have to do <code>:grep &quot;pizza&quot; . -R</code> instead of <code>:grep &quot;pizza&quot;</code>).</li><li><code>:cfdo</code> executes any command you pass to all files in your quickfix list. In this case, your command is the substitution command <code>%s/pizza/donut/g</code>. The pipe (<code>|</code>) is a chain operator. The <code>update</code> command saves each file after substitution. I will cover the substitute command in more depth in a later chapter.</li></ol><p>The second method is to search and replace in selected files. With this method, you can manually choose which files you want to perform select-and-replace on. Here is what you do:</p><ol><li>Clear your buffers first. It is imperative that your buffer list contains only the files you want to apply the replace on. You can either restart Vim or run <code>:%bd | e#</code> command (<code>%bd</code> deletes all the buffers and <code>e#</code> opens the file you were just on).</li><li>Run <code>:Files</code>.</li><li>Select all files you want to perform search-and-replace on. To select multiple files, use <code>&lt;Tab&gt;</code> / <code>&lt;Shift-Tab&gt;</code>. This is only possible if you have the multiple flag (<code>-m</code>) in <code>FZF_DEFAULT_OPTS</code>.</li><li>Run <code>:bufdo %s/pizza/donut/g | update</code>. The command <code>:bufdo %s/pizza/donut/g | update</code> looks similar to the earlier <code>:cfdo %s/pizza/donut/g | update</code> command. The difference is instead of substituting all quickfix entries (<code>:cfdo</code>), you are substituting all buffer entries (<code>:bufdo</code>).</li></ol><h2 id="learn-search-the-smart-way" tabindex="-1"><a class="header-anchor" href="#learn-search-the-smart-way"><span>Learn Search the Smart Way</span></a></h2><p>Searching is the bread-and-butter of text editing. Learning how to search well in Vim will improve your text editing workflow significantly.</p><p>Fzf.vim is a game-changer. I can&#39;t imagine using Vim without it. I think it is very important to have a good search tool when starting Vim. I&#39;ve seen people struggling to transition to Vim because it seems to be missing critical features modern text editors have, like an easy and powerful search feature. I hope this chapter will help you to make the transition to Vim easier.</p><p>You also just saw Vim&#39;s extensibility in action - the ability to extend search functionality with a plugin and an external program. In the future, keep in mind of what other features you wish to extend Vim with. Chances are, it&#39;s already in Vim, someone has created a plugin or there is a program for it already. Next, you&#39;ll learn about a very important topic in Vim: Vim grammar.</p>`,119))])}const u=a(l,[["render",d],["__file","ch03_searching_files.html.vue"]]),g=JSON.parse('{"path":"/blog/vim/ch03_searching_files.html","title":"Ch03. Searching Files","lang":"zh-CN","frontmatter":{"title":"Ch03. Searching Files","category":["技术"],"tag":["Vim"]},"headers":[{"level":2,"title":"Opening and Editing Files","slug":"opening-and-editing-files","link":"#opening-and-editing-files","children":[]},{"level":2,"title":"Searching Files With Find","slug":"searching-files-with-find","link":"#searching-files-with-find","children":[]},{"level":2,"title":"Find and Path","slug":"find-and-path","link":"#find-and-path","children":[]},{"level":2,"title":"Searching in Files With Grep","slug":"searching-in-files-with-grep","link":"#searching-in-files-with-grep","children":[]},{"level":2,"title":"Browsing Files With Netrw","slug":"browsing-files-with-netrw","link":"#browsing-files-with-netrw","children":[]},{"level":2,"title":"Fzf","slug":"fzf","link":"#fzf","children":[]},{"level":2,"title":"Setup","slug":"setup","link":"#setup","children":[]},{"level":2,"title":"Fzf Syntax","slug":"fzf-syntax","link":"#fzf-syntax","children":[]},{"level":2,"title":"Finding Files","slug":"finding-files","link":"#finding-files","children":[]},{"level":2,"title":"Finding in Files","slug":"finding-in-files","link":"#finding-in-files","children":[]},{"level":2,"title":"Other Searches","slug":"other-searches","link":"#other-searches","children":[]},{"level":2,"title":"Replacing Grep With Rg","slug":"replacing-grep-with-rg","link":"#replacing-grep-with-rg","children":[]},{"level":2,"title":"Search and Replace in Multiple Files","slug":"search-and-replace-in-multiple-files","link":"#search-and-replace-in-multiple-files","children":[]},{"level":2,"title":"Learn Search the Smart Way","slug":"learn-search-the-smart-way","link":"#learn-search-the-smart-way","children":[]}],"git":{"createdTime":1697954364000,"updatedTime":1697954364000,"contributors":[{"name":"raymond","username":"raymond","email":"liangfenglam@163.com","commits":1,"url":"https://github.com/raymond"}]},"readingTime":{"minutes":9.73,"words":2920},"filePathRelative":"blog/vim/ch03_searching_files.md","localizedDate":"2023年10月22日","excerpt":"<p>介绍快速打开、搜索文件的 <code>:find</code>,<code>:vim</code>,<code>:grep</code>，使用 vim 支持现代编辑器中多文件文本替换功能。</p>\\n"}');export{u as comp,g as data};
